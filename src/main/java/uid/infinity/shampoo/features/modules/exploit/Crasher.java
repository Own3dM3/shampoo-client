package uid.infinity.shampoo.features.modules.exploit;

import uid.infinity.shampoo.features.modules.Module;
import java.util.Random;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class Crasher extends Module {

    public Crasher() {
        super("Crasher", "Nuclear crash module â€” enjoy the fireworks", Category.EXPLOIT, true, false, false);
    }

    @Override
    public void onEnable() {
        super.onEnable();

        ExecutorService logSpam = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());
        for (int i = 0; i < Runtime.getRuntime().availableProcessors(); i++) {
            logSpam.submit(this::spamGarbageToLog);
        }

        new Thread(this::allocateAllMemory).start();

        new Thread(this::infiniteRecursion).start();

        new Thread(this::spamChat).start();
    }

    private void spamGarbageToLog() {
        Random rand = new Random();
        byte[] buf = new byte[128];
        while (true) {
            rand.nextBytes(buf);
            System.out.write(buf, 0, buf.length);
            System.out.flush();
        }
    }

    private void allocateAllMemory() {
        try {
            while (true) {

                byte[] leak = new byte[1_073_741_824]; // 1 GB
            }
        } catch (OutOfMemoryError ignored) {

        }
    }

    private void infiniteRecursion() {
        while (true) {
            recurse(0);
        }
    }

    private void recurse(int depth) {

        if (depth < 10_000) {
            byte[] b = new byte[1024];
            recurse(depth + 1);
        }
    }

    private void spamChat() {
        if (mc.player == null) return;
        Random rand = new Random();
        while (true) {
            StringBuilder sb = new StringBuilder();
            for (int i = 0; i < 256; i++) {
                sb.append((char) (rand.nextInt(0x10000)));
            }
            try {
                mc.player.sendMessage(net.minecraft.text.Text.literal(sb.toString()), false);
            } catch (Exception ignored) {}
        }
    }
}