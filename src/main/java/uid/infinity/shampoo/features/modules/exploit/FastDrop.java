package uid.infinity.shampoo.features.modules.exploit;

import uid.infinity.shampoo.features.modules.Module;
import uid.infinity.shampoo.features.settings.Setting;
import net.fabricmc.fabric.api.client.event.lifecycle.v1.ClientTickEvents;
import net.minecraft.network.packet.c2s.play.PlayerActionC2SPacket;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Direction;
import net.minecraft.client.MinecraftClient;

public class FastDrop extends Module {

    private final Setting<Integer> delay = register(new Setting<>("Delay", 0, 0, 20));
    private int dropTicks = 0;
    private static final MinecraftClient mc = MinecraftClient.getInstance();

    public FastDrop() {
        super("FastDrop", "Drops items from the hotbar faster", Category.EXPLOIT, true, false, false);

        ClientTickEvents.START_CLIENT_TICK.register(this::onTick);
    }

    private void onTick(MinecraftClient client) {
        if (client.player == null || client.getNetworkHandler() == null) return;
        if (!this.isEnabled()) {
            dropTicks = 0;
            return;
        }

        if (mc.options.dropKey.isPressed()) {
            dropTicks++;

            if (dropTicks > delay.getValue()) {
                PlayerActionC2SPacket packet = new PlayerActionC2SPacket(
                        PlayerActionC2SPacket.Action.DROP_ITEM,
                        BlockPos.ORIGIN,
                        Direction.DOWN
                );
                client.getNetworkHandler().sendPacket(packet);
                dropTicks = 0;
            }
        } else {
            dropTicks = 0;
        }
    }
}